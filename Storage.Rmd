---
title: "Storage for OysterCode"
author: "Ruby K"
date: '2022-06-18'
output: html_document
---
<!--
#### Table #1: Height 

|                  Test                 | P-value | Violation? |
|:-------------------------------------:|:-------:|:----------:|
| Levene's test (equality of variances) |    `r round(height.levene[1,3], digits=4)`     |     No     |
|          Bag 1: Shapiro-Wilk          |   `r round(bag1height.normality$p.value, digits=3)`     |     No     |
|          Bag 2: Shapiro-Wilk          |   `r round(bag2height.normality$p.value, digits=3)`      |     No     |
|          Bag 3: Shapiro-Wilk          |    `r round(bag3height.normality$p.value, digits=3)`     |     No     |
|          Bag 4: Shapiro-Wilk          |     `r round(bag4height.normality$p.value, digits=3)`    |     No     |
-->
<!--
#### Table #2: Length 

|                  Test                 | P-value | Violation? |
|:-------------------------------------:|:-------:|:----------:|
| Levene's test (equality of variances) |    `r round(length.levene[1,3], digits=4)`     |     No     |
|          Bag 1: Shapiro-Wilk          |   `r round(bag1length.normality$p.value, digits=3)`     |     No     |
|          Bag 2: Shapiro-Wilk          |   `r round(bag2length.normality$p.value, digits=3)`      |     No     |
|          Bag 3: Shapiro-Wilk          |    `r round(bag3length.normality$p.value, digits=3)`     |     No     |
|          Bag 4: Shapiro-Wilk          |     `r round(bag4length.normality$p.value, digits=3)`    |     No     |

#### Table #3: Width 

|                  Test                 | P-value | Violation? |
|:-------------------------------------:|:-------:|:----------:|
| Levene's test (equality of variances) |    `r round(width.levene[1,3], digits=4)`     |     No     |
|          Bag 1: Shapiro-Wilk          |   `r round(bag1width.normality$p.value, digits=3)`     |     No     |
|          Bag 2: Shapiro-Wilk          |   `r round(bag2width.normality$p.value, digits=3)`      |     Yes     |
|          Bag 3: Shapiro-Wilk          |    `r round(bag3width.normality$p.value, digits=3)`     |     No     |
|          Bag 4: Shapiro-Wilk          |     `r round(bag4width.normality$p.value, digits=3)`    |     Yes     |
-->

<!--
A one-way ANOVA is considered robust to violations of the normality assumption (e.g., Schmider et al., 2010). If an ANOVA is run on the width data despite the noted normality violations, again no significant differences are found.

```{r echo=FALSE}
WidthResults<-aov(Width~Bag, data=FBout)
summary(WidthResults)
```

dtID<-subset(SamplingNew,select = c(Gear,Location,Oyster))
names(dtID)
any(duplicated(dtID))

names(gsummary(SamplingNew, form=~Oyster, inv=TRUE))
names(gsummary(SamplingNew, form=~Treatment, inv=TRUE))
names(gsummary(SamplingNew, form=~Gear, inv=TRUE))

lmm <- lmer(Cup.ratio ~ Gear + Location + Gear:Location + (1 | Replicate), data = SamplingNew,
            REML = FALSE)
summary(lmm)
Anova(lmm)

lmm3 <- lmer(Cup.ratio ~ Gear + Location + Gear:Location + (1 | Replicate), data = IndividualOysters, REML = FALSE)
summary(lmm3) #variance explained by replicate indistinguishable from 0
Anova(lmm3) #same p-value as when treating bags as replicates for FC

lmm4 <- lm(Cup.ratio ~ Gear + Location + Gear:Location, data = IndividualOysters)
summary(lmm4)
Anova(lmm4) #very similar to above

plot(fitted(lmm4), resid(lmm4))
qqnorm(resid(lmm4)); qqline(resid(lmm4))

lmtest::bptest(lmm4)

#ANOVA of negative sqrt cup ratio (better than reciprocal, prob worse than log)
IndividualOysters$sqrt.Cup.ratio<-(IndividualOysters$Cup.ratio)^(-1/2)
leveneTest(sqrt.Cup.ratio ~ Gear * Location, data = IndividualOysters) #also good, p=0.1836
sqrtCupRatioANOVA <- aov(sqrt.Cup.ratio ~ Gear * Location, data = IndividualOysters)
summary(sqrtCupRatioANOVA)
plot(sqrtCupRatioANOVA,1)
plot(sqrtCupRatioANOVA,2)
qqp(sqrtCupRatioANOVA$residuals)
shapiro.test(sqrtCupRatioANOVA$residuals) #p=1.823e-5

#ANOVA of log.Shell.Shape
IndividualOysters$log.Shell.shape<-log(IndividualOysters$Shell.shape+1)
leveneTest(log.Shell.shape ~ Gear * Location, data = IndividualOysters) #better, p=0.1789
logShellShapeANOVA <- aov(log.Shell.shape ~ Gear * Location, data = IndividualOysters)
summary(logShellShapeANOVA)
plot(logShellShapeANOVA,1)
plot(logShellShapeANOVA,2)
qqp(logShellShapeANOVA$residuals)
shapiro.test(logShellShapeANOVA$residuals) #better, p=1.8e-6

library(WRS2)
t2way(Cup.ratio ~ Gear * Location, data=IndividualOysters)
postCupRatio<-mcp2atm(Cup.ratio ~ Gear * Location, data=IndividualOysters)
postCupRatio
-->


